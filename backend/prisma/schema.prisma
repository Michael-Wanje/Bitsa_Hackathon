generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id            String    @id @default(cuid())
  email         String    @unique
  password      String
  fullName      String
  studentId     String    @unique
  course        String
  yearOfStudy   Int
  phoneNumber   String?
  bio           String?
  role          Role      @default(STUDENT)
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  blogPosts     BlogPost[]
  events        Event[]
  eventRegistrations EventRegistration[]
  
  @@map("users")
}

model BlogPost {
  id            String          @id @default(cuid())
  title         String
  content       String
  excerpt       String?
  thumbnail     String?
  category      String
  author        User            @relation(fields: [authorId], references: [id], onDelete: Cascade)
  authorId      String
  status        ContentStatus   @default(PENDING)
  isAdminPost   Boolean         @default(false)
  publishedAt   DateTime?
  createdAt     DateTime        @default(now())
  updatedAt     DateTime        @updatedAt

  @@map("blog_posts")
}

model Event {
  id            String          @id @default(cuid())
  title         String
  description   String
  date          DateTime
  time          String
  endTime       String?
  location      String
  imageUrl      String?
  author        User            @relation(fields: [authorId], references: [id], onDelete: Cascade)
  authorId      String
  status        ContentStatus   @default(PENDING)
  isAdminPost   Boolean         @default(false)
  createdAt     DateTime        @default(now())
  updatedAt     DateTime        @updatedAt

  registrations EventRegistration[]
  photos        GalleryPhoto[]

  @@map("events")
}

model EventRegistration {
  id         String    @id @default(cuid())
  user       User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId     String
  event      Event     @relation(fields: [eventId], references: [id], onDelete: Cascade)
  eventId    String
  registeredAt DateTime @default(now())

  @@unique([userId, eventId])
  @@map("event_registrations")
}

model GalleryPhoto {
  id        String    @id @default(cuid())
  imageUrl  String
  caption   String?
  event     Event?    @relation(fields: [eventId], references: [id], onDelete: SetNull)
  eventId   String?
  uploadedAt DateTime @default(now())
  updatedAt DateTime  @updatedAt

  @@map("gallery_photos")
}

model ContactMessage {
  id      String    @id @default(cuid())
  name    String
  email   String
  subject String
  message String
  sentAt  DateTime  @default(now())
  isRead  Boolean   @default(false)

  @@map("contact_messages")
}

enum Role {
  STUDENT
  ADMIN
}

enum ContentStatus {
  PENDING
  APPROVED
  REJECTED
}
